{"version":2,"name":"RP Tools - Summarize","disableSend":false,"placeBeforeInput":false,"injectInput":false,"color":"rgba(0, 0, 0, 0)","onlyBorderColor":false,"qrList":[{"id":6,"icon":"fa-lock","showLabel":true,"label":"WI Lock-In","title":"","message":"// Get chat's current chatWI. |\n/getchatwi |\n/setvar key=summ_chatwi {{pipe}} |\n\n/if left=\"{{pipe}}\" right=\"\" rule=eq {: // Check if chatWI exists. |\n\t/preset \"{{var::rp_preset}}\" |\n\t/abort quiet=false Chat WI not set. Aborting.\n:} |\n\n\n/buttons labels=[\"Accept\"] Lock-in Summary entry? |\n\n/if left=\"{{pipe}}\" right=\"Accept\" rule=eq else={:\n\t/abort quiet=false Canceled. Aborting.\n:}\n{:\n\t/echo Summary locked-in.\n:} |\n\n/addvar key=summ_storeid 1 |\n/setvar key=summ_save \"None\" |\n","contextList":[],"preventAutoExecute":true,"isHidden":false,"executeOnStartup":false,"executeOnUser":false,"executeOnAi":false,"executeOnChatChange":false,"executeOnGroupMemberDraft":false,"executeOnNewChat":false,"automationId":""},{"id":2,"icon":"fa-list-alt","showLabel":true,"label":"Summarize","title":"","message":"// Define rople-play and summarization textgen presets |\n/let rp_preset \"Class O\" |\n/let summ_preset \"Class M\" |\n/preset \"{{var::summ_preset}}\" | // Switch to summarization preset |\n\n// Get chat's current chatWI. |\n/getchatwi |\n/setvar key=summ_chatwi {{pipe}} |\n\n/if left=\"{{pipe}}\" right=\"\" rule=eq {: // Check if chatWI exists. |\n\t/preset \"{{var::rp_preset}}\" |\n\t/abort quiet=false Chat WI not set. Aborting.\n:} |\n\n// Define prompt for summarization. |\n/let summ_sys_default \"{{instructSystemPrefix}}You're comprised of various specialized modules, each dedicated to handling specific tasks or domains. These modules activate when needed to ensure optimal performance and achievement of goals, aligning with the provided Instructions.\n\n### Main Information\n{{description}}\n\n### {{char}}'s Persona\n{{personality}}\n\n### {{user}}'s Persona\n{{persona}}\n\n### Summary\n\\\\{\\\\{getvar::summ_save\\\\}\\\\}\n\n### Chat\n\\\\{\\\\{getvar::summ_mes\\\\}\\\\}{{instructSystemSuffix}}{{instructUserPrefix}}### Instruction\n[Pause the Role-play. Summarize the most important facts and events that have happened in the chat so far. If a summary already exists in your memory, use that as a base and expand with new facts. Limit the summary to 500 words or less. Your response should include nothing but the summary.]{{instructUserSuffix}}{{instructAssistantPrefix}}\" |\n\n// Define variables if they don't exist. |\n/if left=\"{{getvar::summ_sys}}\" right=\"\" rule=eq {: // Summarization prompt. |\n\t/setvar key=summ_sys {{var::summ_sys_default}}\n:} |\n\n/if left=\"{{getvar::summ_curid}}\" right=\"\" rule=eq {:\n\t/setvar key=summ_curid -1\n:} |\n\n/if left=\"{{getvar::summ_storeid}}\" right=\"\" rule=eq {:\n\t/setvar key=summ_storeid -1\n:} |\n\n/if left=\"{{getvar::summ_storenum}}\" right=\"\" rule=eq {: // Number of entries containing summaries. |\n\t/setvar key=summ_storenum 0\n:} |\n\n/if left=\"{{getvar::summ_wiid}}\" right=\"\" rule=eq {: // UID of current entry in use for summaries. |\n\t/setvar key=summ_wiid -2\n:} |\n\n/if left=\"{{getvar::summ_mesget}}\" right=\"\" rule=eq {: // Amount of messages to grab each summarization. |\n\t/setvar key=summ_mesget 15\n:} |\n\n\n// Get starting ID of messages to summarize. |\n/add 1 summ_curid |\n/let summ_mesmin {{pipe}} |\n\n// Get ending ID of messages to summarize. |\n/add summ_mesget summ_curid |\n/let summ_mesmax {{pipe}} |\n\n// Grab messages for summarization. |\n/messages names=on hidden=off {{var::summ_mesmin}}-{{var::summ_mesmax}} |\n/setvar key=summ_mes {{pipe}} |\n\n\n/try {: // Attempt to summarize messages. |\n\t/genraw instruct=off length=2048 \"{{var::summ_sys_default}}\"\n:} |\n/catch {: // Revert back to role-play preset and abort if failed/canceled. |\n\t/preset \"{{var::rp_preset}}\" |\n\t/abort quiet=false Generation failed or canceled. Aborting.\n:} |\n\n/input default=\"{{pipe}}\" Look good? |\n/let summ_check {{pipe}} |\n\n\n/if left=\"{{var::summ_check}}\" right=\"\" rule=eq {:\n\t/preset \"{{var::rp_preset}}\" |\n\t/abort quiet=false Canceled. Aborting.\n:} |\n\n/setvar key=summ_old {{getvar::summ_save}} |\n/setvar key=summ_save {{var::summ_check}} |\n\n/if left={{getvar::summ_wiid}} right={{getvar::summ_storeid}} rule=eq else={:\n\t/add summ_storenum 1 |\n\t/setvar key=summ_storenum {{pipe}} |\n\t\n\t/createwi file={{getvar::summ_chatwi}} {{getvar::summ_save}} |\n\t/setvar key=summ_uid {{pipe}} |\n\t\n\t/setwifield file={{getvar::summ_chatwi}} uid={{getvar::summ_uid}} field=constant true |\n\t/setwifield file={{getvar::summ_chatwi}} uid={{getvar::summ_uid}} field=position 4 |\n\t/setwifield file={{getvar::summ_chatwi}} uid={{getvar::summ_uid}} field=depth 10 |\n\t/setwifield file={{getvar::summ_chatwi}} uid={{getvar::summ_uid}} field=order {{getvar::summ_storenum}} |\n\t\n\t/setvar key=summ_wiid {{getvar::summ_storeid}} |\n\t\n\t/add summ_curid summ_mesget |\n\t/setvar key=summ_curid {{pipe}} |\n:}\n{:\n\t/setwifield file={{getvar::summ_chatwi}} uid={{getvar::summ_uid}} field=content {{getvar::summ_save}} |\n\t\n\t/add summ_curid summ_mesget |\n\t/setvar key=summ_curid {{pipe}} |\n:} |\n\n/preset \"{{var::rp_preset}}\"","contextList":[],"preventAutoExecute":true,"isHidden":false,"executeOnStartup":false,"executeOnUser":false,"executeOnAi":false,"executeOnChatChange":false,"executeOnGroupMemberDraft":false,"executeOnNewChat":false,"automationId":""},{"id":4,"icon":"fa-dice","showLabel":true,"label":"Re-Roll","title":"","message":"/getchatwi |\n\n/if left=\"{{pipe}}\" right=\"{{getvar::summ_chatwi}}\" rule=neq {:\n\t/abort quiet=false Incorrect chat WI. Aborting.\n:} |\n\n\n/let summ_sys_default \"{{instructSystemPrefix}}You're comprised of various specialized modules, each dedicated to handling specific tasks or domains. These modules activate when needed to ensure optimal performance and achievement of goals, aligning with the provided Instructions.\n\n### Main Information\n{{description}}\n\n### {{char}}'s Persona\n{{personality}}\n\n### {{user}}'s Persona\n{{persona}}\n\n### Summary\n\\\\{\\\\{getvar::summ_save\\\\}\\\\}\n\n### Chat\n\\\\{\\\\{getvar::summ_mes\\\\}\\\\}{{instructSystemSuffix}}\" |\n\n\n/sub summ_curid summ_mesget |\n/add {{pipe}} 1 |\n/let summ_mesmin {{pipe}} |\n\n/let summ_mesmax {{getvar::summ_curid}} |\n\n/messages names=on hidden=off {{var::summ_mesmin}}-{{var::summ_mesmax}} |\n/setvar key=summ_mes {{pipe}} |\n\n\n/genraw instruct=off system=\"{{getvar::summ_sys}}\" length=2048 \"{{instructUserPrefix}}### Instruction\n[Pause the Role-play. Summarize the most important facts and events that have happened in the chat so far. If a summary already exists in your memory, use that as a base and expand with new facts. Limit the summary to 500 words or less. Your response should include nothing but the summary.]{{instructUserSuffix}}{{instructAssistantPrefix}}\" |\n\n/input default=\"{{pipe}}\" Look good? |\n/let summ_check {{pipe}} |\n\n\n/if left=\"{{var::summ_check}}\" right=\"\" rule=eq {:\n\t/abort quiet=false Canceled. Aborting.\n:} |\n\n/setvar key=summ_save {{var::summ_check}} |\n\n/setwifield file={{getvar::summ_chatwi}} uid={{getvar::summ_uid}} field=content {{getvar::summ_save}} |","contextList":[],"preventAutoExecute":true,"isHidden":false,"executeOnStartup":false,"executeOnUser":false,"executeOnAi":false,"executeOnChatChange":false,"executeOnGroupMemberDraft":false,"executeOnNewChat":false,"automationId":""}],"idIndex":6}